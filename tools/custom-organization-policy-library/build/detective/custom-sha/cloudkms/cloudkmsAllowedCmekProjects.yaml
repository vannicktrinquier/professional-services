#@ load("/sha.lib.star", "build_sha")
#@ sha = build_sha("cloudkmsAllowedCmekProjects")

#@ if sha.to_generate():
severity: MEDIUM
description: "Detect if CMEKs are used from unauthorized projects"
recommendation: "Ensure only CMEKs from authorized projects are used"
resource_selector:
  resource_types:
  - cloudkms.googleapis.com/CryptoKey
predicate:
  expression: (!['mysecurity-project'].exists(prj, resource.name.startsWith('projects/' + prj)))
#@ end
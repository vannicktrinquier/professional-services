cloudsql_sqlserver_instance_allowed:
  steps:
  - command: >- 
      gcloud sql instances create {{ prefix }}-cloudsql-sqlserver-allowed
      --availability-type=REGIONAL 
      --region=asia-southeast2 
      --cpu 1
      --memory 4
      --database-version=SQLSERVER_2022_WEB 
      --enable-point-in-time-recovery
      --root-password=R00tP@ss0rd11@@ 
      --enable-password-policy 
      --password-policy-min-length=12 
      --password-policy-complexity=COMPLEXITY_DEFAULT  
      --backup-location=asia-southeast1 
      --retained-backups-count=10 
      --storage-type=SSD    
      --ssl-mode=ENCRYPTED_ONLY
      --database-flags="external scripts enabled"=off,"cross db ownership chaining"=off,"user connections"=0,"user options"=0,"remote access"=off,"3625"=on,"contained database authentication"=off
    exitcode: 0
    teardown: gcloud sql instances delete {{ prefix }}-cloudsql-sqlserver-allowed
  tags:
    - cloudsql
    - sqlserver
cloudsql_sqlserver_instance_no_values_allowed:
  steps:
  - command: >- 
      gcloud sql instances create {{ prefix }}-cloudsql-sqlserver-no-values-allowed
      --availability-type=REGIONAL 
      --region=asia-southeast2 
      --cpu 1
      --memory 4
      --database-version=SQLSERVER_2022_WEB 
      --enable-point-in-time-recovery
      --root-password=R00tP@ss0rd11@@ 
      --enable-password-policy 
      --password-policy-min-length=12 
      --password-policy-complexity=COMPLEXITY_DEFAULT  
      --backup-location=asia-southeast1 
      --retained-backups-count=10 
      --storage-type=SSD    
      --ssl-mode=ENCRYPTED_ONLY
      --database-flags="remote access"=off,"3625"=on
    exitcode: 0
    teardown: gcloud sql instances delete {{ prefix }}-cloudsql-sqlserver-no-values-allowed
  tags:
    - cloudsql
    - sqlserver
cloudsql_sqlserver_instance_no_ssl_mode_encrypted:
  steps:
  - command: >- 
      gcloud sql instances create {{ prefix }}-cloudsql-sqlserver-no-ssl-mode
      --availability-type=REGIONAL 
      --region=asia-southeast2 
      --cpu 1
      --memory 4
      --database-version=SQLSERVER_2022_WEB 
      --enable-point-in-time-recovery
      --root-password=R00tP@ss0rd11@@ 
      --enable-password-policy 
      --password-policy-min-length=12 
      --password-policy-complexity=COMPLEXITY_DEFAULT  
      --backup-location=asia-southeast1 
      --retained-backups-count=10 
      --storage-type=SSD      
      --database-flags="external scripts enabled"=off,"cross db ownership chaining"=off,"user connections"=0,"user options"=0,"remote access"=off,"3625"=on,"contained database authentication"=off
    exitcode: 1
    stderr: "customConstraints/custom.cloudsqlRequireSSLConnection"
    teardown: gcloud sql instances delete {{ prefix }}-cloudsql-sqlserver-no-ssl-mode
  tags:
    - cloudsql
    - sqlserver
cloudsql_sqlserver_instance_no_public_authorized_networks:
  steps:
  - command: >- 
      gcloud sql instances create {{ prefix }}-cloudsql-sqlserver-no-public-authorized-networks
      --availability-type=REGIONAL 
      --region=asia-southeast2 
      --cpu 1
      --memory 4
      --database-version=SQLSERVER_2022_WEB 
      --enable-point-in-time-recovery
      --root-password=R00tP@ss0rd11@@ 
      --enable-password-policy 
      --password-policy-min-length=12 
      --password-policy-complexity=COMPLEXITY_DEFAULT  
      --backup-location=asia-southeast1 
      --retained-backups-count=10 
      --storage-type=SSD     
      --database-flags="external scripts enabled"=off,"cross db ownership chaining"=off,"user connections"=0,"user options"=0,"remote access"=off,"3625"=on,"contained database authentication"=off
      --ssl-mode=ENCRYPTED_ONLY 
      --authorized-networks=0.0.0.0/0
    exitcode: 1
    stderr: "customConstraints/custom.cloudsqlDisablePublicAuthorizedNetworks"
    teardown: gcloud sql instances delete {{ prefix }}-cloudsql-sqlserver-no-public-authorized-networks
  tags:
    - cloudsql
    - sqlserver
cloudsql_sqlserver_instance_no_backup:
  steps:
  - command: >- 
      gcloud sql instances create {{ prefix }}-cloudsql-sqlserver-no-backup
      --availability-type=REGIONAL 
      --region=asia-southeast2 
      --cpu 1
      --memory 4
      --database-version=SQLSERVER_2022_WEB 
      --root-password=R00tP@ss0rd11@@ 
      --enable-password-policy 
      --password-policy-min-length=12 
      --password-policy-complexity=COMPLEXITY_DEFAULT  
      --storage-type=SSD    
      --database-flags="external scripts enabled"=off,"cross db ownership chaining"=off,"user connections"=0,"user options"=0,"remote access"=off,"3625"=on,"contained database authentication"=off
      --ssl-mode=ENCRYPTED_ONLY
    exitcode: 1
    stderr: "customConstraints/custom.cloudsqlRequireAutomatedBackup"
    teardown: gcloud sql instances delete {{ prefix }}-cloudsql-sqlserver-no-backup
  tags:
    - cloudsql
    - sqlserver
cloudsql_sqlserver_instance_external_scripts_enabled_on:
  steps:
  - command: >- 
      gcloud sql instances create {{ prefix }}-cloudsql-sqlserver-external-scripts-enabled-on
      --availability-type=REGIONAL 
      --region=asia-southeast2 
      --cpu 1
      --memory 4
      --database-version=SQLSERVER_2022_WEB 
      --enable-point-in-time-recovery
      --root-password=R00tP@ss0rd11@@ 
      --enable-password-policy 
      --password-policy-min-length=12 
      --password-policy-complexity=COMPLEXITY_DEFAULT  
      --backup-location=asia-southeast1 
      --retained-backups-count=10 
      --storage-type=SSD    
      --ssl-mode=ENCRYPTED_ONLY
      --database-flags="external scripts enabled"=on,"cross db ownership chaining"=off,"user connections"=0,"user options"=0,"remote access"=off,"3625"=on,"contained database authentication"=off
    exitcode: 1
    stderr: "customConstraints/custom.cloudsqlRequireSQLServerDatabaseFlags"
    teardown: gcloud sql instances delete {{ prefix }}-cloudsql-sqlserver-external-scripts-enabled-on
  tags:
    - cloudsql
    - sqlserver
cloudsql_sqlserver_instance_cross_db_ownership_chaining_on:
  steps:
  - command: >- 
      gcloud sql instances create {{ prefix }}-cloudsql-sqlserver-cross-db-ownership-chaining-on
      --availability-type=REGIONAL 
      --region=asia-southeast2 
      --cpu 1
      --memory 4
      --database-version=SQLSERVER_2022_WEB 
      --enable-point-in-time-recovery
      --root-password=R00tP@ss0rd11@@ 
      --enable-password-policy 
      --password-policy-min-length=12 
      --password-policy-complexity=COMPLEXITY_DEFAULT  
      --backup-location=asia-southeast1 
      --retained-backups-count=10 
      --storage-type=SSD    
      --ssl-mode=ENCRYPTED_ONLY
      --database-flags="external scripts enabled"=off,"cross db ownership chaining"=on,"user connections"=0,"user options"=0,"remote access"=off,"3625"=on,"contained database authentication"=off
    exitcode: 1
    stderr: "customConstraints/custom.cloudsqlRequireSQLServerDatabaseFlags"
    teardown: gcloud sql instances delete {{ prefix }}-cloudsql-sqlserver-cross-db-ownership-chaining-on
  tags:
    - cloudsql
    - sqlserver
cloudsql_sqlserver_instance_contained_database_authentication_on:
  steps:
  - command: >- 
      gcloud sql instances create {{ prefix }}-cloudsql-sqlserver-contained-db-authentication-on
      --availability-type=REGIONAL 
      --region=asia-southeast2 
      --cpu 1
      --memory 4
      --database-version=SQLSERVER_2022_WEB 
      --enable-point-in-time-recovery
      --root-password=R00tP@ss0rd11@@ 
      --enable-password-policy 
      --password-policy-min-length=12 
      --password-policy-complexity=COMPLEXITY_DEFAULT  
      --backup-location=asia-southeast1 
      --retained-backups-count=10 
      --storage-type=SSD    
      --ssl-mode=ENCRYPTED_ONLY
      --database-flags="external scripts enabled"=off,"cross db ownership chaining"=off,"user connections"=0,"user options"=0,"remote access"=off,"3625"=on,"contained database authentication"=on
    exitcode: 1
    stderr: "customConstraints/custom.cloudsqlRequireSQLServerDatabaseFlags"
    teardown: gcloud sql instances delete {{ prefix }}-cloudsql-sqlserver-contained-db-authentication-on
  tags:
    - cloudsql
    - sqlserver
cloudsql_sqlserver_instance_user_connections_set:
  steps:
  - command: >- 
      gcloud sql instances create {{ prefix }}-cloudsql-sqlserver-user-connections-set
      --availability-type=REGIONAL 
      --region=asia-southeast2 
      --cpu 1
      --memory 4
      --database-version=SQLSERVER_2022_WEB 
      --enable-point-in-time-recovery
      --root-password=R00tP@ss0rd11@@ 
      --enable-password-policy 
      --password-policy-min-length=12 
      --password-policy-complexity=COMPLEXITY_DEFAULT  
      --backup-location=asia-southeast1 
      --retained-backups-count=10 
      --storage-type=SSD    
      --ssl-mode=ENCRYPTED_ONLY
      --database-flags="external scripts enabled"=off,"cross db ownership chaining"=off,"user connections"=100,"remote access"=off,"3625"=on,"contained database authentication"=off
    exitcode: 1
    stderr: "customConstraints/custom.cloudsqlRequireSQLServerDatabaseFlags"
    teardown: gcloud sql instances delete {{ prefix }}-cloudsql-sqlserver-user-connections-set
  tags:
    - cloudsql
    - sqlserver
cloudsql_sqlserver_instance_user_options_set:
  steps:
  - command: >- 
      gcloud sql instances create {{ prefix }}-cloudsql-sqlserver-user-options-set
      --availability-type=REGIONAL 
      --region=asia-southeast2 
      --cpu 1
      --memory 4
      --database-version=SQLSERVER_2022_WEB 
      --enable-point-in-time-recovery
      --root-password=R00tP@ss0rd11@@ 
      --enable-password-policy 
      --password-policy-min-length=12 
      --password-policy-complexity=COMPLEXITY_DEFAULT  
      --backup-location=asia-southeast1 
      --retained-backups-count=10 
      --storage-type=SSD    
      --ssl-mode=ENCRYPTED_ONLY
      --database-flags="external scripts enabled"=off,"cross db ownership chaining"=off,"user connections"=0,"remote access"=off,"3625"=on,"contained database authentication"=off,"user options"=100
    exitcode: 1
    stderr: "customConstraints/custom.cloudsqlRequireSQLServerDatabaseFlags"
    teardown: gcloud sql instances delete {{ prefix }}-cloudsql-sqlserver-user-options-set
  tags:
    - cloudsql
    - sqlserver
cloudsql_sqlserver_instance_remote_access_on:
  steps:
  - command: >- 
      gcloud sql instances create {{ prefix }}-cloudsql-sqlserver-remote-access-on
      --availability-type=REGIONAL 
      --region=asia-southeast2 
      --cpu 1
      --memory 4
      --database-version=SQLSERVER_2022_WEB 
      --enable-point-in-time-recovery
      --root-password=R00tP@ss0rd11@@ 
      --enable-password-policy 
      --password-policy-min-length=12 
      --password-policy-complexity=COMPLEXITY_DEFAULT  
      --backup-location=asia-southeast1 
      --retained-backups-count=10 
      --storage-type=SSD    
      --ssl-mode=ENCRYPTED_ONLY
      --database-flags="external scripts enabled"=off,"cross db ownership chaining"=off,"user connections"=0,"user options"=0,"remote access"=on,"3625"=on,"contained database authentication"=off
    exitcode: 1
    stderr: "customConstraints/custom.cloudsqlRequireSQLServerDatabaseFlags"
    teardown: gcloud sql instances delete {{ prefix }}-cloudsql-sqlserver-remote-access-on
  tags:
    - cloudsql
    - sqlserver
cloudsql_sqlserver_instance_remote_access_unset:
  steps:
  - command: >- 
      gcloud sql instances create {{ prefix }}-cloudsql-sqlserver-remote-access-unset
      --availability-type=REGIONAL 
      --region=asia-southeast2 
      --cpu 1
      --memory 4
      --database-version=SQLSERVER_2022_WEB 
      --enable-point-in-time-recovery
      --root-password=R00tP@ss0rd11@@ 
      --enable-password-policy 
      --password-policy-min-length=12 
      --password-policy-complexity=COMPLEXITY_DEFAULT  
      --backup-location=asia-southeast1 
      --retained-backups-count=10 
      --storage-type=SSD    
      --ssl-mode=ENCRYPTED_ONLY
      --database-flags="external scripts enabled"=off,"cross db ownership chaining"=off,"user connections"=0,"user options"=0,"3625"=on,"contained database authentication"=off
    exitcode: 1
    stderr: "customConstraints/custom.cloudsqlRequireSQLServerDatabaseFlags"
    teardown: gcloud sql instances delete {{ prefix }}-cloudsql-sqlserver-remote-access-unset
  tags:
    - cloudsql
    - sqlserver
cloudsql_sqlserver_instance_trace_3265_off:
  steps:
  - command: >- 
      gcloud sql instances create {{ prefix }}-cloudsql-sqlserver-trace-3265-off
      --availability-type=REGIONAL 
      --region=asia-southeast2 
      --cpu 1
      --memory 4
      --database-version=SQLSERVER_2022_WEB 
      --enable-point-in-time-recovery
      --root-password=R00tP@ss0rd11@@ 
      --enable-password-policy 
      --password-policy-min-length=12 
      --password-policy-complexity=COMPLEXITY_DEFAULT  
      --backup-location=asia-southeast1 
      --retained-backups-count=10 
      --storage-type=SSD    
      --ssl-mode=ENCRYPTED_ONLY
      --database-flags="external scripts enabled"=off,"cross db ownership chaining"=off,"user connections"=0,"user options"=0,"remote access"=on,"3625"=off,"contained database authentication"=off
    exitcode: 1
    stderr: "customConstraints/custom.cloudsqlRequireSQLServerDatabaseFlags"
    teardown: gcloud sql instances delete {{ prefix }}-cloudsql-sqlserver-trace-3265-off
  tags:
    - cloudsql
    - sqlserver
cloudsql_sqlserver_instance_trace_3265_unset:
  steps:
  - command: >- 
      gcloud sql instances create {{ prefix }}-cloudsql-sqlserver-trace-3265-unset
      --availability-type=REGIONAL 
      --region=asia-southeast2 
      --cpu 1
      --memory 4
      --database-version=SQLSERVER_2022_WEB 
      --enable-point-in-time-recovery
      --root-password=R00tP@ss0rd11@@ 
      --enable-password-policy 
      --password-policy-min-length=12 
      --password-policy-complexity=COMPLEXITY_DEFAULT  
      --backup-location=asia-southeast1 
      --retained-backups-count=10 
      --storage-type=SSD    
      --ssl-mode=ENCRYPTED_ONLY
      --database-flags="external scripts enabled"=off,"cross db ownership chaining"=off,"user connections"=0,"user options"=0,"remote access"=on,"contained database authentication"=off
    exitcode: 1
    stderr: "customConstraints/custom.cloudsqlRequireSQLServerDatabaseFlags"
    teardown: gcloud sql instances delete {{ prefix }}-cloudsql-sqlserver-trace-3265-unset
  tags:
    - cloudsql
    - sqlserver
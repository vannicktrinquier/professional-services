before_tests:
  - command: >- 
      gcloud compute networks create cuop-vpc-network
      --subnet-mode=custom
      --bgp-routing-mode=global
    teardown_command: >-
      gcloud compute networks delete cuop-vpc-network
  - command: >- 
      gcloud compute networks subnets create subnet-vm 
      --network=cuop-vpc-network 
      --range=10.10.0.0/24 
      --region=asia-southeast2
    teardown_command: >-
      gcloud compute networks subnets delete subnet-vm 
      --region=asia-southeast2
  - command: gcloud compute network-firewall-policies create cuop-fw-policy --global
    teardown_command: gcloud compute network-firewall-policies delete cuop-fw-policy --global
  - command: >-
      gcloud kms keyrings create {{ prefix }}-key-ring-1 
      --location=asia-southeast2
    expected_result:
      return_code: 0
  - command: gcloud iam service-accounts create iam-sa-binding-allowed
    expected_result:
      return_code: 0
  - command: gcloud iam service-accounts create iam-sa-binding-unallowed
    expected_result:
      return_code: 0

after_tests:
  - command: gcloud iam service-accounts delete iam-sa-binding-allowed@{{ project }}.iam.gserviceaccount.com
    expected_result:
      return_code: 0
  - command: gcloud iam service-accounts delete iam-sa-binding-unallowed@{{ project }}.iam.gserviceaccount.com
    expected_result:
      return_code: 0
